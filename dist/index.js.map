{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import { useLayoutEffect, useState, useRef } from 'react'\nimport { v4 as uuidv4 } from 'uuid'\n\nconst defaultSize = [0, 0]\n\nlet resizeObserver\nconst callbacks = {}\n\n/**\n * Returns current width and height of specified element.\n *\n * @param {Ref} ref element to use in size calculation\n */\nconst useElementSize = ref => {\n  const [size, setSize] = useState(defaultSize)\n  // set unique id or reuse element's existing unique id\n  const elId = useRef(ref?.current?.getAttribute('resize-id') || `resize-${uuidv4()}`)\n\n  const updateSizes = entries => {\n    entries?.forEach(entry => {\n      const target = entry.target.current || entry.target\n      callbacks[target.getAttribute('resize-id')].forEach(c => c(entry))\n    })\n  }\n\n  // all instances use the same observer\n  resizeObserver = resizeObserver || new ResizeObserver(updateSizes)\n\n  useLayoutEffect(() => {\n    if (!ref?.current) return\n\n    ref.current.setAttribute('resize-id', elId.current)\n\n    // set initial size\n    setSize([\n      ref?.current?.getBoundingClientRect().width,\n      ref?.current?.getBoundingClientRect().height,\n    ])\n\n    // add callback for this instance\n    // more than one callback can be added for an element\n    // in case of two instances watching the same ref\n    callbacks[elId.current] = [\n      ...callbacks[elId.current] || [],\n      entry => {\n      if (!entry) return\n\n      if (entry.contentBoxSize?.[0]) {\n        setSize([entry.contentBoxSize[0].inlineSize, entry.contentBoxSize[0].blockSize])\n      } else if (entry?.contentBoxSize) {\n        setSize([entry.contentBoxSize.inlineSize, entry.contentBoxSize[0].blockSize])\n      } else {\n        setSize([entry.contentRect.width, entry.contentRect.height])\n      }\n    }]\n\n    // watch for size changes\n    resizeObserver.observe(ref?.current)\n\n    // eslint-disable-next-line consistent-return\n    return () => {\n      if (!ref?.current) return\n\n      resizeObserver.unobserve(ref?.current)\n    }\n  }, [ref?.current])\n\n  return size\n}\n\nexport default useElementSize\n"],"names":["resizeObserver","defaultSize","callbacks","ref","useState","size","setSize","elId","useRef","current","getAttribute","uuidv4","ResizeObserver","entries","forEach","entry","target","c","useLayoutEffect","setAttribute","_ref$current2","getBoundingClientRect","width","_ref$current3","height","contentBoxSize","_entry$contentBoxSize","inlineSize","blockSize","contentRect","observe","unobserve"],"mappings":"IAKIA,uCAFEC,EAAc,CAAC,EAAG,GAGlBC,EAAY,kBAOK,SAAAC,WACGC,WAASH,GAA1BI,OAAMC,OAEPC,EAAOC,UAAOL,MAAAA,aAAAA,EAAKM,8BAASC,aAAa,yBAA0BC,QAmDzE,OAzCAX,EAAiBA,GAAkB,IAAIY,eARnB,SAAAC,GAClBA,MAAAA,GAAAA,EAASC,QAAQ,SAAAC,GAEfb,GADea,EAAMC,OAAOP,SAAWM,EAAMC,QAC5BN,aAAa,cAAcI,QAAQ,SAAAG,UAAKA,EAAEF,SAO/DG,kBAAgB,mBACd,GAAKf,MAAAA,GAAAA,EAAKM,QA+BV,OA7BAN,EAAIM,QAAQU,aAAa,YAAaZ,EAAKE,SAG3CH,EAAQ,CACNH,MAAAA,aAAAA,EAAKM,4BAALW,EAAcC,wBAAwBC,MACtCnB,MAAAA,aAAAA,EAAKM,4BAALc,EAAcF,wBAAwBG,SAMxCtB,EAAUK,EAAKE,mBACVP,EAAUK,EAAKE,UAAY,IAC9B,SAAAM,SACKA,cAEDA,EAAMU,6BAANC,EAAuB,GACzBpB,EAAQ,CAACS,EAAMU,eAAe,GAAGE,WAAYZ,EAAMU,eAAe,GAAGG,YAErEtB,EADSS,MAAAA,GAAAA,EAAOU,eACR,CAACV,EAAMU,eAAeE,WAAYZ,EAAMU,eAAe,GAAGG,WAE1D,CAACb,EAAMc,YAAYP,MAAOP,EAAMc,YAAYL,aAKxDxB,EAAe8B,QAAQ3B,MAAAA,SAAAA,EAAKM,oBAIrBN,MAAAA,GAAAA,EAAKM,SAEVT,EAAe+B,UAAU5B,MAAAA,SAAAA,EAAKM,WAE/B,CAACN,MAAAA,SAAAA,EAAKM,UAEFJ"}